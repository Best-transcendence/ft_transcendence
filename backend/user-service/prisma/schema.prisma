// User Service Database Schema
// This is the user management microservice database
// Contains user profiles, friends, and game-related data
// TODO: check if we can use prisma or have to get rid of it

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("USER_DATABASE_URL")
}

// User profile model for user service
// Contains profile data, friends, and game statistics
model UserProfile {
  id          Int      @id @default(autoincrement())
  authUserId  Int      @unique  // References auth-service user ID
  name        String   @unique
  email       String   // Duplicated from auth-service for performance
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Profile information
  profilePicture String @default("/assets/default-avatar.jpeg")
  bio           String @default("Hi, I'm playing Arcade Clash")

  // Friends relationships (many-to-many)
  friends       UserProfile[] @relation("UserFriends") // Who's in my friends list
  friendOf      UserProfile[] @relation("UserFriends") // Whose friendlist I'm in
}

// Match type enum
enum MatchType {
  ONE_VS_ONE
  TOURNAMENT_INTERMEDIATE
  TOURNAMENT_FINAL
}

// Match table model
model Match {
  id           Int        @id @default(autoincrement())
  type         MatchType  // Match type: 1v1, Tournament Intermediate, or Tournament Final
  date         DateTime   @default(now())
  player1Id    Int?       // First player's user ID
  player2Id    Int?       // Second player's user ID
  winnerId     Int?       // Winner's user ID (null if draw)
  player1Score Int
  player2Score Int
  createdAt    DateTime   @default(now())
}