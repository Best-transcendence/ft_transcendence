// User Service Database Schema
// This is the user management microservice database
// Contains user profiles, friends, and game-related data
// TODO: check if we can use prisma or have to get rid of it

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("USER_DATABASE_URL")
}

// User profile model for user service
// Contains profile data, friends, and game statistics
model UserProfile {
  id          Int      @id @default(autoincrement())
  authUserId  Int      @unique  // References auth-service user ID
  name        String   @unique
  email       String   // Duplicated from auth-service for performance
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Profile information
  profilePicture String @default("/assets/default-avatar.jpeg")
  bio           String @default("Hi, I'm playing Arcade Clash")

  // Friends relationships (many-to-many)
  friends       UserProfile[] @relation("UserFriends") // Who's in my friends list
  friendOf      UserProfile[] @relation("UserFriends") // Whose friendlist I'm in

  // Match history relationships
  player1Matches Match[] @relation("Player1Matches")
  player2Matches Match[] @relation("Player2Matches")

  // including Stats model
  stats     Stats?
}

  // Match table model
  model Match {
  id           Int      @id @default(autoincrement())
  type         String   // "tournament", "1v1" or "AI"
  date         DateTime @default(now())
  player1Id    Int?
  player2Id    Int?
  player1Score Int
  player2Score Int
  createdAt   DateTime @default(now())

  // Connections with players
  player1     UserProfile? @relation("Player1Matches", fields: [player1Id], references: [id])
  player2     UserProfile? @relation("Player2Matches", fields: [player2Id], references: [id])
}

	//stats dahsboard module
model Stats {
  userId            Int         @id
  user              UserProfile @relation(fields: [userId], references: [id], onDelete: Cascade)   // TODO: do we need to have optiont for deleting profile? if the user is deleted delet this row automatically?

  gamesPlayed       Int         @default(0)
  wins              Int         @default(0)
  losses            Int         @default(0)
  draws             Int         @default(0)

  pointsFor         Int         @default(0)   // total points scored
  pointsAgainst     Int         @default(0)   // total points conceded
  highestScore      Int         @default(0)

  updatedAt         DateTime    @updatedAt
}