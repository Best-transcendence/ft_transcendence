# User Service Makefile

.PHONY: all run clean docker docker-clean logs

# Default target - run all installations
all:
	@echo "ðŸ“¦ Installing user-service dependencies..."
	npm install
	@echo "ðŸ”§ Generating Prisma client..."
	npx prisma generate
	@echo "ðŸ—„ï¸ Running database migrations..."
	npx prisma migrate dev --name init
	@echo "ðŸŒ± Seeding database..."
	npm run seed
	@echo "âœ… User service setup complete!"
	@echo "ðŸš€ Starting user-service development server..."
	npm run dev

# Just run the service (assumes already installed)
run:
	@echo "ðŸš€ Starting user-service development server..."
	npm run dev

# Clean up (including Docker)
clean:
	@echo "ðŸ§¹ Cleaning up..."
	rm -rf node_modules
	rm -f prisma/user.db
	rm -f prisma/*.db
	@echo "ðŸ³ Cleaning Docker resources..."
	docker stop user_service 2>/dev/null || true
	docker rm user_service 2>/dev/null || true
	docker rmi ft_transcendence_user_service 2>/dev/null || true

# Docker: build if needed and start
docker:
	@echo "ðŸ³ Building user-service Docker image..."
	docker build -t ft_transcendence_user_service .
	@echo "ðŸš€ Starting user-service Docker container..."
	docker run -d --name user_service -p 3002:3002 ft_transcendence_user_service
	@echo "âœ… Container started! Following logs..."
	@echo "ðŸ“‹ Press Ctrl+C to stop following logs (container keeps running)"
	docker logs -f user_service

# Docker: clean existing images for this service
docker-clean:
	@echo "ðŸ§¹ Cleaning up Docker resources for user-service..."
	docker stop user_service 2>/dev/null || true
	docker rm user_service 2>/dev/null || true
	docker rmi ft_transcendence_user_service 2>/dev/null || true

# Docker: follow logs in real-time
logs:
	@echo "ðŸ“‹ Following user-service logs (Ctrl+C to stop)..."
	docker logs -f user_service
