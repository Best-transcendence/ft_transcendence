# Frontend Makefile

.PHONY: all run clean docker docker-clean logs

# Default target - run all installations
all:
	@echo "ðŸ§¹ Cleaning cache..."
	rm -rf .parcel-cache dist
	@echo "ðŸ“¦ Installing frontend dependencies..."
	npm install
	@echo "ðŸ“¦ Installing TailwindCSS dependencies..."
	npm install -D tailwindcss postcss autoprefixer
	@echo "ðŸŽ¨ Building TailwindCSS..."
	npx tailwindcss -i ./public/styles.css -o ./public/output.css
	@echo "âœ… Frontend setup complete!"
	@echo "ðŸš€ Starting frontend development server..."
	npm run dev

# Just run the service (assumes already installed)
run:
	@echo "ðŸš€ Starting frontend development server..."
	npm run dev

# Clean up (including Docker)
clean:
	@echo "ðŸ§¹ Cleaning up..."
	rm -rf node_modules
	rm -rf dist
	rm -rf .parcel-cache
	rm -f public/output.css
	@echo "ðŸ³ Cleaning Docker resources..."
	docker stop frontend_service 2>/dev/null || true
	docker rm frontend_service 2>/dev/null || true
	docker rmi ft_transcendence_frontend 2>/dev/null || true

# Docker: build if needed and start
docker:
	@echo "ðŸ³ Building frontend Docker image..."
	docker build -t ft_transcendence_frontend .
	@echo "ðŸ›‘ Stopping existing container if running..."
	docker stop frontend_service 2>/dev/null || true
	docker rm frontend_service 2>/dev/null || true
	@echo "ðŸš€ Starting frontend Docker container..."
	docker network create ft_transcendence_network 2>/dev/null || true
	docker run -d --name frontend_service --network ft_transcendence_network -p 3000:3000 ft_transcendence_frontend
	@echo "âœ… Container started! Following logs..."
	@echo "ðŸ“‹ Press Ctrl+C to stop following logs (container keeps running)"
	docker logs -f frontend_service

# Docker: clean existing images for this service
docker-clean:
	@echo "ðŸ§¹ Cleaning up Docker resources for frontend..."
	docker stop frontend_service 2>/dev/null || true
	docker rm frontend_service 2>/dev/null || true
	docker rmi ft_transcendence_frontend 2>/dev/null || true

# Docker: follow logs in real-time
logs:
	@echo "ðŸ“‹ Following frontend logs (Ctrl+C to stop)..."
	docker logs -f frontend_service
